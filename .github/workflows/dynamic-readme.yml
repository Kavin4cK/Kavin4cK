name: Dynamic README with Time-Based Greeting

on:
  schedule:
    - cron: '0 */3 * * *'  # Runs every 3 hours
  workflow_dispatch:  # Allows manual trigger
  push:
    branches:
      - main

jobs:
  update-readme:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        
      - name: Update README with time-based greeting
        run: |
          # Get current hour in IST (India Standard Time)
          CURRENT_HOUR=$(TZ='Asia/Kolkata' date +%H)
          
          # Determine greeting based on time
          if [ $CURRENT_HOUR -ge 5 ] && [ $CURRENT_HOUR -lt 12 ]; then
            GREETING="Good Morning ‚òÄÔ∏è"
            EMOJI="üåÖ"
            MESSAGE="Rise and shine! Time to build something amazing."
            THEME_COLOR="FFA500"
          elif [ $CURRENT_HOUR -ge 12 ] && [ $CURRENT_HOUR -lt 17 ]; then
            GREETING="Good Afternoon üå§Ô∏è"
            EMOJI="‚òÄÔ∏è"
            MESSAGE="Hope you're having a productive day!"
            THEME_COLOR="FFD700"
          elif [ $CURRENT_HOUR -ge 17 ] && [ $CURRENT_HOUR -lt 21 ]; then
            GREETING="Good Evening üåÜ"
            EMOJI="üåá"
            MESSAGE="Evening coding sessions hit different!"
            THEME_COLOR="FF6B6B"
          else
            GREETING="Good Night üåô"
            EMOJI="‚ú®"
            MESSAGE="Burning the midnight oil? Remember to rest!"
            THEME_COLOR="4A5899"
          fi
          
          # Get current date
          CURRENT_DATE=$(TZ='Asia/Kolkata' date '+%A, %B %d, %Y')
          CURRENT_TIME=$(TZ='Asia/Kolkata' date '+%I:%M %p IST')
          
          # Random dev quote
          QUOTES=(
            "Code is like humor. When you have to explain it, it's bad."
            "First, solve the problem. Then, write the code."
            "The best error message is the one that never shows up."
            "Clean code always looks like it was written by someone who cares."
            "Make it work, make it right, make it fast."
            "Any fool can write code that a computer can understand. Good programmers write code that humans can understand."
          )
          RANDOM_INDEX=$((RANDOM % 6))
          RANDOM_QUOTE="${QUOTES[$RANDOM_INDEX]}"
          
          # Update README with sed
          sed -i "s|^# .*|# $GREETING|" README.md
          sed -i "s|color=[A-F0-9]*&height|color=$THEME_COLOR\&height|" README.md
          sed -i "s|text=.*&fontSize|text=$EMOJI\&fontSize|" README.md
          sed -i "s|### üïê Last Updated:.*|### üïê Last Updated: $CURRENT_DATE at $CURRENT_TIME|" README.md
          sed -i "s|\*.*\*|\*$MESSAGE\*|" README.md
          sed -i "0,/\".*\"/s//\"$RANDOM_QUOTE\"/" README.md
          
      - name: Commit and push if changed
        run: |
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git config --global user.name "github-actions[bot]"
          git add README.md
          git diff --quiet && git diff --staged --quiet || (git commit -m "ü§ñ Auto-update: Dynamic greeting [$(TZ='Asia/Kolkata' date '+%Y-%m-%d %H:%M IST')]" && git push)